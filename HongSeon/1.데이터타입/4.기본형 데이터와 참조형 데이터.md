# (1-4-1) 불변값
> ### 변수와 상수를 구분하는 성질은 <u>변경 가능성</u> <br>
> 변수와 상수를 구분 짓는 변경 가능성의 대상은 <u>변수 영역</u> 메모리 <br>
> 불변성 여부를 구분할 때의 변경 가능성의 대상은 <u>데이터 영역</u> 메모리 <br>
> 원시형 데이터들은 모두 <u>불변값</u>

### 불변성 예시
```javascript
var a = "abc";
a = a + "def";

var b = 5;
var c = 5;
b = 7;
```
1. 변수 a에 문자열 "abc"를 할당 했다가 뒤에 "def"추가하면 기존의 "abc"가 바뀌는게 아니라 새로운 문자열 "abcdef"를 만들어 그 주소를 변수 a에 저장
2. 변수 b에 5를 할당하면 데이터 영역에서 5를 찾고 없으면 데이터 공간을 하나 만들어 저장하고 그 주소를 b에 저장, c에 같은 수인 5를 할당하려고 하면 데이터 영역에서 5를 찾아 기존에 있는 주소를 재활용
3. 변수 b의 값을 7로 바꾸면 기존 저장된 5자체를 7로 바꾸는 것이 아니라 데이터 영역에서 7을 찾아본 뒤 있으면 재활용을 하고 없다면 새로 만들어 b에 저장하기 때문에 5와 7 모두 다른 값으로 변경할 수 없다.

이처럼 숫자, 문자열 같은 원시형 데이터들은 다른 값을 변경할 수 없다. <u>변경은 새로 만드는 동작을 통해서만 이루어진다.</u> 이것이 바로 불변값의 성질이며 한 번 만들어진 값은 <u>가비지 컬렉팅</u>을 당하지 않는 한 영원히 변하지 않는다.

<br>

# (1-4-2) 가변값
* 원시형 데이터는 모두 <u>불변값</u>
* 참조형 데이터는 기본적인 성질은 <u>가변값</u>인 경우가 많지만 설정에 따라 변경 불가능한 경우도 있고, 아에 불변값으로 활용하는 방안이 존재

## 참조형 데이터의 할당
```javascript
var obj1 = {
    a : 1,
    b: "bbb"
}
```
|주소(변수 영역)|1001|1002|1003|1004|
|:---:|:---:|:---:|:---:|:---:|
|데이터(변수 영역)|  |이름 : obj1 <br> 값 : @5001  |  |  |
|**주소 (데이터 영역)**| 5001 |5002|5003|5004|
|데이터(데이터 영역)|@7103 ~ ?  |  | 1 |"bbb"|

<br>

|**주소 (객체 5001의 변수영역)**| 7103 |7104|7105|7106|
|:---:|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : a <br> 값 : @5003  | 이름 : b <br> 값 : @5004   |  |  |

1. 변수 영역의 빈공간 @1002번 확보 후 주소 이름을 obj1으로 지정
2. 여러 개의 프로퍼티로 이루어진 데이터 그룹이므로 별도의 변수 영역을 마련하고 그 영역의 주소인 @7103~?를 @5001에 저장
3. @7103과 @7104에 각각 a와 b라는 프로퍼티 이름을 저장
4. 데이터 영역에서 1을 검색 후 없으므로 임의로 @5003에 저장 후 주소를 @7103에 저장
5. 마찬가지로 "bbb" 검색 후 없으므로 임읠 @5004에 저장 후 주소를 @7104에 저장 

> 기본형 데이터와 차이는 "<u>객체의 변수(프로퍼티)영역</u>"이 별도로 존재한다는 점<br>
> 객체가 별도로 할애한 영역은 변수 영역일 뿐 "<u>데이터 영역</u>"은 기존의 메모리 공간을 그대로 활용<br>
> 데이터 영역에 저장된 값은 모두 <u>불변값</u>이지만 변수에는 다른 값을 얼마든지 대입 가능<br>
> 이 부분 때문에 참조형 데이터는 <u>가변값</u>이라고 함

<br>

## 참조형 데이터의 프로퍼티 재할당
```javascript
var obj1 = {
    a : 1,
    b: "bbb"
}
obj1.a = 2;
```

|주소(변수 영역)|1001|1002|1003|1004|1005|
|:---:|:---:|:---:|:---:|:---:|:---:|
|데이터(변수 영역)|  |이름 : obj1 <br> 값 : @5001  |  |  |  |
|**주소 (데이터 영역)**| 5001 |5002|5003|5004|5005|
|데이터(데이터 영역)|@7103 ~ ?  |  | 1 |"bbb"|2|

<br>

|**주소 (객체 5001의 변수영역)**| 7103 |7104|7105|7106|
|:---:|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : a <br> 값 : @5005  | 이름 : b <br> 값 : @5004   |  |  |

1. obj1의 a 프로퍼티에 숫자 2를 할당하기 위해 데이터 영역에서 2를 검색
2. 2가 존재하지 않으므로 빈 공간@5005에 저장하고 이 주소를 @7103에 저장

> ojb.a = 2 명령 전과 후에 변수 obj1이 바라보고 있는 주소는 @5001로 변하지 않음 <br>
> 즉, <u>새로운 객체</u>를 만들어 진 것이 아니라 기존의 내부의 값만 바뀐 것

<br>

## 중첩된 참조형 데이터의 프로퍼티 할당
* 참조형 데이터의 프로퍼티에 다시 참조형 데이터를 할당하는 경우 <u>중첩객체</u>라고 불림

```javascript
var = obj = {
    x: 3,
    arr : [3, 4, 5]
}
```

|주소(변수 영역)|1001|1002|1003|1004|1005|
|:---:|:---:|:---:|:---:|:---:|:---:|
|데이터(변수 영역)|  |이름 : obj <br> 값 : @5001  |  |  |  |
|**주소 (데이터 영역)**| 5001 |5002|5003|5004|5005|
|데이터(데이터 영역)|@7103 ~ ?  | 3 | @8104 ~ ? |4|5|

<br>

|**주소 (객체 5001의 변수영역)**| 7103 |7104|7105|7106|
|:---:|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : x <br> 값 : @5002  | 이름 : arr <br> 값 : @5003   |  |  |

<br>

|**주소 (배열 5003의 변수영역)**| 8104 |8105|8106|
|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : 0 <br> 값 : @5002  | 이름 : 1 <br> 값 : @5004 | 이름 : 2 <br> 값 : @5005   |

1. 변수 영역 @1002를 확보하고 그 주소 이름을 obj로 지정
2. 데이터의 종류가 여러 개의 변수와 값들을 모아놓은 객체이기 때문에 이 객체의 각 변수(프로퍼티)들을 저장하기 위해 별도의 변수 영역 @7103~?을 마련하고 그 영역의 주소를 @5001에 저장
3. @7103에 이름 x, @7104에 이름 arr저장
4. 데이터 영역에서 숫자 3를 검색 후 없으므로 임으로 @5002에 저장 후 이 주소를 @7130에 저장
5. @7104에 저장할 값은 배열이기 때문에 내부의 프로퍼티를 저장하기 위해 별도의 변수영역 @8104~?를 마련하고 그 영역의 주소를 @5003에 저장 한 다음 @5003을 @7014에 저장
6. 배열의 요소가 총 3개이므로 3개의 변수 공간 확보 후 인덱스 부여
7. 데이터 영역에서 3을 검색한 후 있으므로 그 주소를 @8104에 저장
8. 데이터 영역에서 4를 검색한 후 없으므로 @5004에 저장하고 이 주소를 @8105에 저장
9. 데이터 영역에서 5를 검색한 후 없으므로 @5005에 저장하고 이 주소를 @8106에 저장

### obj.arr[1]을 검색할 때의 순차
> 1. obj 검색1 : obj라는 식별자를 가진 주소를 찾음 <br>
> 2. obj 검색2 : 값이 주소이므로 그 주소로 이동 <br>
> 3. obj 검색3 : 값이 주소이므로 그 주소로 이동 <br>
> 4. obj.arr 검색1 : arr라는 식별자를 가진 주소 찾음 <br>
> 5. obj.arr 검색2 : 값이 주소이므로 그 주소로 이동 <br>
> 6. obj.arr 검색3 : 값이 주소이므로 그 주소로 이동 <br>
> 7. obj.arr[1] 검색1 : 인덱스 1에 해당하는 주소 찾음 <br>
> 8. obj.arr[1] 검색2 : 값이 주소이므로 그 주소로 이동 <br>
> 9. obj.arr[1] 검색3 : 값이 숫자형 데이터이므로 4 반환 <br>
> <br>
> **@1002 -> @5001 -> (@7103~?) -> @7104 -> @5003 -> (@8104~?) -> @8105 <br> -> @5004 -> 4반환**

### 이 상태에서 값을 재할당 할 경우
```javascript
obj.arr = "str";
```

|주소(변수 영역)|1001|1002|1003|1004|1005|1006|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|데이터(변수 영역)|  |이름 : obj <br> 값 : @5001  |  |  |  |  |
|**주소 (데이터 영역)**| 5001 |5002|***<u>5003</u>***|5004|5005|5006|
|데이터(데이터 영역)|@7103 ~ ?  | 3 |***<u>@8104 ~ ?</u>***|4|5|"str"

<br>

|**주소 (객체 5001의 변수영역)**| 7103 |7104|7105|7106|
|:---:|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : x <br> 값 : @5002  | 이름 : arr <br> 값 : @5006   |  |  |

<br>


|***<u>주소 (배열 5003의 변수영역)</u>***|***<u>8104</u>*** |***<u>8105</u>***|***<u>8106</u>***|
|:---:|:---:|:---:|:---:|
|***<u>데이터 (객체 5001의 변수영역)</u>***|***<u>이름 : 0 <br> 값 : @5002  </u>***| ***<u>이름 : 1 <br> 값 : @5004 </u>***| ***<u>이름 : 2 <br> 값 : @5005  </u>*** |

* ***밑줄 친 부분은 가비지컬렉터(CG) 수거 대상***

> 어떤 데이터에 대해 자신의 주소를 참조하는 변수의 개수를 참조 카운트라고 하는데 이 카운트가 0인 메모리 주소는 가비지 컬렉터의 수거 대상이 되고 메모리 사용량이 포화 상태에 임박할 때마다 자동으로 수거대상들을 수거해 다시 새로운 값을 할당할 수 있는 빈 공간으로 만듬

> 이렇게 재할당을 하게 되면 @5003은 더이상 자신의 주소를 참조하느 변수가 하나도 없게 되기 때문에 가비지 컬렉터의 대상이 되고 연쇄작용으로 @8104~?도 가비지 컬렉터의 대상이 되어 언젠간 사라지게 된다 <br>

<br>

# (1-4-3) 변수 복사 비교
```javascript
// 원시형 데이터 복사
var a = 10;
var b = a;

// 참조형 데이터 복사
var obj1 = {c: 10, d: "ddd"};
var obj2 = obj1
```
## 원시형 데이터
|주소(변수 영역)|1001|1002|
|:---:|:---:|:---:|
|데이터(변수 영역)| 이름 : a <br> 값 : @5001 |이름 :b <br> 값 : @5001  |  
|**주소 (데이터 영역)**| 5001 |5002|
|데이터(데이터 영역)| 10 | |

> 기본형 데이터의 경우 변수 영역에 빈공간 @1002를 확보하고 식별자로 b로 지정 후 식별자 a를 검색해 그 값을 찾아 와야 한다. @1001에 저장된 값인 @5001들고 좀 전에 확보해둔 @1002에 값으로 대입 후 종료한다. 



## ***변수 복사 후 값 변경시 원시형 데이터의 변화***
```javascript 
var b = 15;
```

|주소(변수 영역)|1001|1002|
|:---:|:---:|:---:|
|데이터(변수 영역)| 이름 : a <br> 값 : @5001 |이름 :b <br> 값 : @5002  |  
|**주소 (데이터 영역)**| 5001 |5002|
|데이터(데이터 영역)| 10 | 15 |

* 원시형 데이터를 복사한 후 값을 바꾸면 @1002의 값이 달라진다.

---

## 참조형 데이터
|주소(변수 영역)|1001|1002|1003|1004|
|:---:|:---:|:---:|:---:|:---:|
|데이터(변수 영역)|  |   |이름 : obj1 <br> 값 : @5002 | 이름 : obj2 <br> 값 : @5002 |
|**주소 (데이터 영역)**| 5001 |5002 |5003|5004|
|데이터(데이터 영역)| 10 | @7103 ~ ?   | "ddd" |  |

<br>

|**주소 (객체 5002의 변수영역)**| 7103 |7104|7105|7106|
|:---:|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : c <br> 값 : @5001  | 이름 : d <br> 값 : @5003  |

> 참조형 데이터의 경우 변수 영역의 빈 공간 @1003를 화고해 식별자 obj로 지정 후 데이터 영역의 빈 공간 @5002을 확보하고 데이터 그룹이 담겨야하기 때문에 별도의 변수 영역 @7103~?을 확보해 그 주소를 저정한다. @7103에는 식별자 c를 @7104에는 식별자 d를 입력한 후 c에 대입할 값 10을 데이터 영역에서 탐색 후 그 주소를 @7103에 연결하고 문자열 ddd도 마찬가로 데이터영역에서 탐색후 주소를 @7104에 연결한다.

## ***변수 복사 후 값 변경시 참조형 데이터의 변화***
```javascript 
obj2 = {c: 20, d: "ddd"};
```
|주소(변수 영역)|1001|1002|1003|1004|
|:---:|:---:|:---:|:---:|:---:|
|데이터(변수 영역)|  |   |이름 : obj1 <br> 값 : @5002 | 이름 : obj2 <br> 값 : @5002 |
|**주소 (데이터 영역)**| 5001 |5002 |5003|5004|
|데이터(데이터 영역)| 10 | @7103 ~ ?   | "ddd" | 20 |

|**주소 (객체 5002의 변수영역)**| 7103 |7104|7105|7106|
|:---:|:---:|:---:|:---:|:---:|
|데이터 (객체 5001의 변수영역)|이름 : c <br> 값 : @5004  | 이름 : d <br> 값 : @5003  |

* 참조형 데이터를 복사한 후 복사한 변수 obj2의 프로퍼티를 바꿨더니 @1004의 값은 달라지지 않는다.


## 원시형 데이터와 참조형데이터의 복사 차이
위의 결과를 살펴보면 결론은
 - 원시형 데이터의 경우는 a와 b가 서로 다른 주소를 바라보게 되었음
 - 참조형 데이터의 경우 obj1과 obj2는 여전히 같은 객체를 바라보고 있음

이를 코드로 표현하면 아래와 같다
```javascript
a !== b;
obj1 === obj2;
```

> 대부분의 자바스크립트 책에서 "***기본형은 값을 복사하고 참조현은 주솟값을 복사한다***"라고 설명하지만 사실 어떤 데이터 타입이든 변수에 할당하기 위해서는 주솟값을 복사해야 하기 때문에 자바스크립트의 모든 데이터 타입은 참조형 데이터일 수 밖에 없다.<br>
> 다만 원시형은 주솟값을 복사하는 과정이 1번만 이뤄지고 참조형은 한 단계를 더 거치는 방법의 차이가 있다.





